<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Document</title>
<script type="text/javascript" src="js/jquery.js"></script>
</head>
<body>
    tel
    <input type="text" id="number">
    msg
    <input type="text" id="msg">
    qr
    <input type="text" id="qr">



<input id="confirmar" type="button" class="buttonMain" value="Confirmar">
<script>

$("#confirmar").click(function () {
    number = $("#number").val();
    msg = $("#msg").val();
    qr = $("#qr").val();

    qrCode(number,qr);
});

async function whatstxt(number,msg){
  const response = await fetch('http://192.168.0.100:3333/sendText', {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(
        {
            sessionName: "session1", 
            number: number,
            text:msg
        }
    )
  });
  const content = await response.json();

  console.log(content);
};  

async function qrCode(number,qr) {
    const qrNumber = qr; 
    const data = {qrNumber};
    const options = {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
    };
    const response = await fetch('/qr/gerar', options);
    const retorno = await response.json();
    whatsQR(number,retorno);
};  


async function whatsQR(number,qrCode64){
    console.log("Enviando");
    console.log(qrCode64);
    console.log(number);
    const response = await fetch('http://192.168.0.100:3333/sendFile', {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(
        {
            sessionName: "session1", 
            number: number,
            base64Data:qrCode64, //hexadecimal
            fileName:"qrCode.png",
            caption: "CoreTechs Locker" //optional
        }
    )
  });
  const content = await response.json();

  console.log(content);
}; 

</script>
</body>
</html>